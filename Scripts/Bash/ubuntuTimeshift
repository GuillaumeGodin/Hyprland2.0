#!/bin/bash

# --- Functions ---

install_timeshift() {
    echo "------------------------------------------"
    echo "  Installing Timeshift..."
    echo "------------------------------------------"
    sudo apt update -y
    sudo apt install -y software-properties-common
    sudo add-apt-repository -y ppa:teejee2008/timeshift
    sudo apt update -y
    sudo apt install -y timeshift
    echo "Finished!"
}

remove_timeshift() {
    echo "------------------------------------------"
    echo "  Removing Timeshift..."
    echo "------------------------------------------"
    sudo apt purge -y timeshift
    sudo add-apt-repository --remove -y ppa:teejee2008/timeshift
    sudo apt autoremove -y
    echo "Timeshift has been removed."
}

setup_daily_backups() {
    echo "------------------------------------------"
    echo "  Setting up Daily Schedule (Keep 7)"
    echo "------------------------------------------"
    
    # Check if timeshift is installed first
    if ! command -v timeshift &> /dev/null; then
        echo "Error: Timeshift is not installed. Run installTimeshift first."
        exit 1
    fi

    # Set schedule: Daily, Keep 7
    # Note: This assumes you are using RSYNC (the default for most Ubuntu users)
    sudo timeshift --rsync
    sudo timeshift --schedule-daily --count 7
    
    echo "Success: Scheduled to keep the last 7 daily snapshots."
    sudo timeshift --check
}

# --- Command Logic ---

case "$1" in
    installTimeshift)
        install_timeshift
        ;;
    removeTimeshift)
        remove_timeshift
        ;;
    Daily)
        setup_daily_backups
        ;;
    *)
        echo "Usage: $0 {installTimeshift|removeTimeshift|Daily}"
        exit 1
        ;;
esac