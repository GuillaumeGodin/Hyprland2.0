#!/bin/bash

case "$1" in
    -h|--help)
        echo "Usage: ./ubuntu [command]"
        echo ""
        echo "Commands:"
        echo "  installDocker       Installs Docker Engine and Compose"
        echo "  removeDocker        Completely removes Docker from system"
        echo "  installRadarr       Setup Radarr (Movies) on port 5050"
        echo "  removeRadarr        Stop and remove Radarr container"
        echo "  installSonarr       Setup Sonarr (TV Shows) on port 5051"
        echo "  removeSonarr        Stop and remove Sonarr container"
        echo "  installProwlarr     Setup Prowlarr (Indexers) on port 5003"
        echo "  removeProwlarr      Stop and remove Prowlarr container"
        echo "  installPhotoPrism   Setup PhotoPrism on port 2342"
        echo "  removePhotoPrism    Stop and remove PhotoPrism container"
        echo "  installNavidrome    Setup Navidrome (Music) on port 5006"
        echo "  removeNavidrome     Stop and remove Navidrome container"
        ;;

    installDocker)
        echo "Installing Docker Engine..."

        sudo apt update
        sudo apt install -y ca-certificates curl gnupg
        sudo install -m 0755 -d /etc/apt/keyrings
        curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
        sudo chmod a+r /etc/apt/keyrings/docker.gpg
        echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu $(. /etc/os-release && echo "$VERSION_CODENAME") stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
        sudo apt update
        sudo apt install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
        sudo usermod -aG docker $USER
        echo "Installation Complete! Running test..."
        sudo docker run hello-world
        echo "IMPORTANT: Log out and back in to use docker without sudo."
        ;;

    removeDocker)
        echo "Removing Docker..."

        docker stop $(docker ps -aq) 2>/dev/null
        docker system prune -a --volumes --force 2>/dev/null
        sudo apt-get purge -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
        sudo rm -rf /var/lib/docker /var/lib/containerd /etc/docker ~/.docker
        sudo rm /etc/apt/sources.list.d/docker.list /etc/apt/keyrings/docker.gpg 2>/dev/null
        sudo apt-get autoremove -y
        echo "Docker removed."
        ;;

    installRadarr)
        echo "Setting up Radarr..."

        mkdir -p /home/$USER/Docker/radarr/{config,movies}

        docker run -d \
          --name radarr \
          -p 5050:7878 \
          -e PUID=1000 \
          -e PGID=1000 \
          -v /home/$USER/Docker/radarr/config:/config \
          -v /home/$USER/Docker/radarr/movies:/movies \
          -v /media/md0:/md0 \
          -v /media/md0/Media/Media_Arr/Deluge:/Deluge \
          --restart=unless-stopped \
          linuxserver/radarr:latest
        echo "Radarr running on port 5050!"
        ;;

    removeRadarr)
        docker stop radarr 2>/dev/null && docker rm radarr 2>/dev/null
        echo "Radarr container removed."
        ;;

    installSonarr)
        echo "Setting up Sonarr..."

        mkdir -p /home/$USER/Docker/sonarr/{config,tv}

        docker run -d \
          --name sonarr \
          -p 5051:8989 \
          -e PUID=1000 \
          -e PGID=1000 \
          -v /home/$USER/Docker/sonarr/config:/config \
          -v /home/$USER/Docker/sonarr/tv:/tv \
          -v /media/md0:/md0 \
          -v /media/md0/Media/Media_Arr/Deluge:/Deluge \
          --restart=unless-stopped \
          linuxserver/sonarr:latest
        echo "Sonarr running on port 5051!"
        ;;

    removeSonarr)
        docker stop sonarr 2>/dev/null && docker rm sonarr 2>/dev/null
        echo "Sonarr container removed."
        ;;

    installProwlarr)
        echo "Setting up Prowlarr..."

        mkdir -p /home/$USER/Docker/prowlarr/{config,downloads,media}

        docker run -d \
          --name prowlarr \
          --network=bridge \
          -p 5003:9696 \
          -e PUID=1000 \
          -e PGID=1000 \
          -e TZ="America/Toronto" \
          -v /home/$USER/Docker/prowlarr/config:/config \
          -v /home/$USER/Docker/prowlarr/downloads:/downloads \
          -v /home/$USER/Docker/prowlarr/media:/media \
          -v /media/md0:/md0 \
          --restart unless-stopped \
          linuxserver/prowlarr
        echo "Prowlarr running on port 5003!"
        ;;

    removeProwlarr)
        docker stop prowlarr 2>/dev/null && docker rm prowlarr 2>/dev/null
        echo "Prowlarr container removed."
        ;;

    installPhotoPrism)
        echo "Setting up PhotoPrism..."

        mkdir -p /home/$USER/Docker/photoprism/{photos,storage}

        docker run -d \
          --name photoprism \
          -p 2342:2342 \
          -e PHOTOPRISM_ADMIN_PASSWORD="yourpassword" \
          -e PHOTOPRISM_DEBUG="false" \
          -e PHOTOPRISM_PUBLIC="false" \
          -v /home/$USER/Docker/photoprism/photos:/photoprism/originals \
          -v /home/$USER/Docker/photoprism/storage:/photoprism/storage \
          -v /media/md0:/md0 \
          --restart=unless-stopped \
          photoprism/photoprism:latest
        echo "PhotoPrism running on port 2342!"
        ;;

    removePhotoPrism)
        docker stop photoprism 2>/dev/null && docker rm photoprism 2>/dev/null
        echo "PhotoPrism container removed."
        ;;

    installNavidrome)
        echo "Setting up Navidrome..."

        mkdir -p /home/$USER/Docker/navidrome/{music,config}

        docker run -d \
          --name navidrome \
          -p 5006:4533 \
          -e ND_LOGLEVEL=info \
          -v /media/md0:/music \
          -v /home/$USER/Docker/navidrome/config:/config \
          -v /media/md0:/md0 \
          --restart=unless-stopped \
          deluan/navidrome:latest
        echo "Navidrome running on port 5006!"
        ;;

    removeNavidrome)
        docker stop navidrome 2>/dev/null && docker rm navidrome 2>/dev/null
        echo "Navidrome container removed."
        ;;

    *)
        echo "Error: Invalid argument '$1'"
        echo "Use ./ubuntu -h for help."
        exit 1
        ;;
esac