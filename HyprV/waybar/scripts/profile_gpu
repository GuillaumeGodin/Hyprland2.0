#!/bin/bash

# Help function for easy maintenance
show_help() {
    echo -e "\e[1;34mAsus GPU Mode Switcher\e[0m"
    echo "---------------------------"
    echo "Usage: set-gpu [OPTION]"
    echo ""
    echo "Options:"
    echo "  integrated    Saves battery (Nvidia OFF, requires Logout)"
    echo "  hybrid        Standard use (Nvidia ON-DEMAND, requires Logout)"
    echo "  mux           Max Gaming (Nvidia ONLY, requires REBOOT)"
    echo "  -h, --help    Show this help message"
    echo ""
    echo -e "Current Status: \e[1;32m$(supergfxctl -g)\e[0m"
}

# Check if help is requested or no argument is provided
if [[ "$1" == "-h" || "$1" == "--help" || -z "$1" ]]; then
    show_help
    exit 0
fi

case "${1,,}" in
    integrated)
        echo "Switching to Integrated... Please wait."
        sudo supergfxctl -m Integrated
        
        echo "Hardware ready. Logging out now..."
        sleep 2
        echo "This is where it would reboot..."
        # hyprctl dispatch exit 0 || loginctl terminate-user $USER
        ;;
    hybrid)
        echo "Switching to Hybrid... Please wait."
        sudo supergfxctl -m Hybrid
        
        echo "Hardware ready. Logging out now..."
        sleep 2
        echo "This is where it would reboot..."
        # hyprctl dispatch exit 0 || loginctl terminate-user $USER
        ;;
    mux)
        echo "Switching to MUX (Ultimate) mode..."
        sudo supergfxctl -m AsusMuxDgpu
        echo "REBOOTING in 5 seconds..."
        sleep 5
        systemctl reboot
        ;;
    *)
        echo -e "\e[1;31mError: Invalid option '$1'\e[0m"
        show_help
        exit 1
        ;;
esac