#!/bin/bash

get_pwr() {
    # Extract just the profile name (Quiet, Balanced, or Performance)
    PWR=$(asusctl profile -p | grep "Active profile is" | awk '{print $NF}')
}

get_pwr

# 1. Logic for Waybar Display
case "$PWR" in
    "Quiet")
        text="󰾆"
        tooltip="Quiet Mode (CPU Throttled)"
        ;;
    "Balanced")
        text="󰾅"
        tooltip="Balanced Mode"
        ;;
    "Performance")
        text="󰓅"
        tooltip="Performance Mode (High Fans)"
        ;;
    *)
        text="󰠠"
        tooltip="Unknown Profile"
        ;;
esac

echo '{"text": "'$text'", "tooltip": "'$tooltip'"}'

# 2. Toggle Logic
if [[ "$1" == "next" ]]; then
    # Cycle profile
    asusctl profile -n
    get_pwr
    # Refresh Waybar
    pkill -SIGRTMIN+8 waybar
    # Notify user
    notify-send -h string:x-canonical-private-synchronous:sys-notify -u low "Asus Profile: $PWR"
fi